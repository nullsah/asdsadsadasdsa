
local Services = {
    Players = game:GetService("Players")
}
Services.LocalPlayer = Services.Players.LocalPlayer

getgenv().ChinaHatSettings = {
    enabled = true, 
    hatColor = Color3.fromRGB(255, 255, 255),
    scale = Vector3.new(1.7, 1.1, 1.7), 
}

local function RemoveOldHats(Character)
    for _, child in ipairs(Character:GetChildren()) do
        if child:IsA("Part") and child:FindFirstChildOfClass("SpecialMesh") then
            if child.MeshId == "rbxassetid://1033714" then
                child:Destroy()
            end
        end
    end
end

local function CreateHat(Character)
    local Head = Character:FindFirstChild("Head")
    if not Head then return end

    -- Optional: Remove old hats before adding a new one
    RemoveOldHats(Character)

    local Cone = Instance.new("Part")
    Cone.Name = "ChinaHat"
    Cone.Size = Vector3.new(1, 1, 1)
    Cone.BrickColor = BrickColor.White()
    Cone.Material = Enum.Material.Neon
    Cone.Transparency = 0
    Cone.Anchored = false
    Cone.CanCollide = false
    Cone.Color = getgenv().ChinaHatSettings.hatColor 

    local Mesh = Instance.new("SpecialMesh")
    Mesh.MeshType = Enum.MeshType.FileMesh
    Mesh.MeshId = "rbxassetid://1033714"
    Mesh.Scale = getgenv().ChinaHatSettings.scale 
    Mesh.Parent = Cone

    local Weld = Instance.new("Weld")
    Weld.Part0 = Head
    Weld.Part1 = Cone
    Weld.C0 = CFrame.new(0, 0.9, 0)
    Weld.Parent = Cone

    Cone.Parent = Character
end

local function OnCharacterAdded(Character)
    coroutine.wrap(function()
        if getgenv().ChinaHatSettings.enabled then
            Character:WaitForChild("Head")
            CreateHat(Character)
        end
    end)()
end

Services.LocalPlayer.CharacterAdded:Connect(OnCharacterAdded)

-- In case character already exists
if Services.LocalPlayer.Character then
    OnCharacterAdded(Services.LocalPlayer.Character)
end

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
